<html>
<head>
<meta charset="utf-8" />
  <title>CSCI 150 - Lab 13 - Civic Data Mashup</title>
  <link rel="stylesheet" type="text/css" title="Default" href="../style.css">
</head>

<body>
<h1><a href="../index.html">CSCI 150</a> - Lab 13<br>Civic Data Mashup</h1>

<h2>Materials</h2>
<ul>
<li><a href="https://cocalc.com/">CoCalc</a>
<li><a href="http://matplotlib.org/">matplotlib</a>
<li><a href="../data/Schools.csv">Conway Schools Data</a>
<li><a href="../data/Tornado_Sirens.csv">Conway Tornado Sirens Data</a>
</ul>
<h2>Overview</h2>
Since 1999, over <a href="http://thecabin.net/slideshow/2014-02-07/faulkner-county-tornadoes#slide-1">
20 tornadoes</a> have touched down in Faulkner County. According to the <a href="http://cityofconway.org/pages/conway-prepared/">Conway Prepared</a>:
<blockquote>
The City of Conway Outdoor Warning Siren system consists of 22 sirens strategically placed throughout the City. 
The sirens may be activated individually or simultaneously to provide a general alert for the entire community. 
</blockquote>
With the continual expansion of Conway in recent years, are there locations in need of new sirens?
We will explore this question by calculating and visualizing the relationship between the locations of sirens
and educational institutions in Conway.
<h2>Step 1 - Creating a CoCalc account </h2>
To perform our data analysis, we will need to create an account on 
<a href="https://cocalc.com/">CoCalc</a>. Navigate
to this website, and click on the green button
to create your free account with your hendrix.edu email address.
<p>
Once you are logged in, you will see the <b>Projects</b> area. This will be 
where you can create workspaces for analysis. In the Project Title box, type
Civic Data Mashup, then select the green Create Project button below.
<p>
You should now find a blue link to Civic Data Mashup, click this link to enter 
the project space. There will be no files found right now, so select the large + 
to Create a new file.
<p>
Name your new file lab13, and select <b>Jupyter Notebook</b> as the type. Your
browser should look like this:
<p>
<img src="../images/cocalcstart.png" width=600>

<h2>Step 2 - Getting started</h2>
We are now ready to start coding and drawing some figures. Here we will generate some
random data to learn how the plotting functions work.
<h3>Jupyter Notebooks</h3>

Our first step will be to see how the Jupyter Notebook lets us write Python code. Select 
the grey box labeled "In [ ]:", and type the following lines of code:
<p>
<pre>
print("hello Jupyter!")
x = 2 + 3
</pre>
<p>
To execute this code, hit <b>Shift+Enter</b>. Notice that this block is now labeled "In [1]:",
the output is below, and a new block has appeared. In this block type the following and 
hit Shift+Enter.
<p>
<pre>
y = x * 7
print(y)</pre>
<p>
We can see that it is easy to group our code into blocks
and execute pieces of it individually with the Shift+Enter keys. The variables will be 
stored across blocks. 
<p>
Before we can draw some figures, we will need a few more libraries. Paste the code below
into a block in your notebook and hit Shift+Enter to execute it.
<p>
<pre>
%matplotlib inline

import math
import random
import matplotlib
from matplotlib import pyplot as plt
</pre>
<p>
This will load up the math and random libraries, and the <a href="http://matplotlib.org/">matplotlib</a> library, which we
will use for all of our plotting functions. Your code should now look like this:
<p>
<img src="../images/cocalcstep2.png" width=600>
<h3>Histograms</h3>
In the Matplotlib
module, there is a function 
<a href="https://matplotlib.org/devdocs/api/_as_gen/matplotlib.pyplot.hist.html"><code>hist</code></a> 
that will draw a histogram when given a list of numbers. 
<p>
For our first plots, we will visualize the distribution of random numbers
draw from our random module with <code>random.random()</code>. Recall that 
these numbers should be uniformly distributed between 0 and 1. 
<p>
<h4>Task 2.1</h4>
Write a small piece of code that will generate 1000 elements in a list
called <code>nums</code>, where each element is a uniform random number from 0 to 1. Then, write <code>plt.hist(nums)</code> to draw the image 
in your notebook. It should look like this
<p>
<img src="../images/cocalcuniformhist.png" width=300>

<h4>Task 2.2</h4>
Write a small piece of code that will generate 1000 elements in a list
called <code>nums2</code>, where each element is the sum of <b>two</b> uniform random numbers from 0 to 1. 
Then, write <code>plt.hist(nums2)</code> to draw the image 
in your notebook.
<p>
<img src="../images/cocalchist2.png" width=300>
<h3>Scatter Plots</h3>
When we have two-dimensional data, it is common to display this with a 
<a href="https://matplotlib.org/devdocs/api/_as_gen/matplotlib.pyplot.scatter.html">scatter plot</a>. 
The <code>scatter</code> function will draw such a graph in Matplotlib.
<h4>Task 2.3</h4>
Write a small piece of code that will generate 10000 elements in two lists
called <code>xs</code>, and <code>ys</code>, where each element is the sum of <b>three</b> uniform random number from 0 to 1. 
Then, write <code>plt.scatter(xs, ys)</code> to draw the image 
in your notebook.
<p>
<img src="../images/cocalcscatter.png" width=300>
<h4>Task 2.4</h4>
It is hard to see the pattern in the data because the many of the points overlap.
We can change the size, color, and transparency of the points with additional parameters.
<p>
Change your earlier scatter plot call to
<code>plt.scatter(xs, ys, s=100, c="r", alpha=0.02)</code>.
<p>
<img src="../images/cocalcscatter2.png" width=300>
<h3>Labeling, Aspect Ratio</h3>
While we did make a scatter plot above, the image is more of a rectangle and not a square
to match our actual coordinates. We can control the <b>aspect ratio</b> of the image and
the size of the image by adding the following two lines before our call to <code>plt.scatter</code>.
<p>
<pre>
fig = plt.figure(figsize=(6, 6), dpi=100)
plt.axes().set_aspect(1)
</pre>
<p>
These will set the size of the image to be at least 6 inches by 6 inches, and have
a 1:1 aspect ratio between our x and y axes.
<p>
Second, it is always a good idea to title our figures and label our axes. We can add
this flair with the following three lines.
<p>
<pre>
plt.xlabel("X values")
plt.ylabel("Y values")
plt.title("Sum of Three Random Numbers")
</pre>
<p>
<h4>Task 2.5</h4>
Copy your code from task 2.4, and add the above code to your scatter plot.
<p>
<img src="../images/cocalcscatter3.png" width=400>

<h2>Step 3 - Finding Distances </h2>
We will be analyzing GIS data for this lab, where points on the Earth are described using 
Latitude and Longitude. For example, the center of the city of Conway is at 35.0887° N Latitude, 
92.4421° W Longitude, Little Rock is at
34.7465° N Latitude, 92.2896° W Longitude, and Tokyo is at 35.6895° N Latitude, 139.6917° E Longitude. 
<p>
Because the Earth is a sphere, these coordinates
use degrees as their units. Also, because of a spherical Earth, we cannot simply calculate
a distance between the two points using the Euclidean distance formula. We will need to 
calculate the <a href="https://en.wikipedia.org/wiki/Great-circle_distance">Great Circle Distance</a>
between the two points to know how far along the globe we will need to travel. This algorithm is as follows, using
ϕ  for latitude and 	λ  for longitude.
<ul>
<li>Convert the latitude and longitude into radians.
<li>Calculate the following formula:<br>
<img src="../images/CodeCogsEqn.gif" width=500>
<li>Convert the result back into degrees.
<li>To find the distance in miles, multiply this by 69, since there are 69 standard miles in one degree of latitude.
</ul>
Also, latitudes that are south of the equator and longitudes that are west of the prime meridian are first converted to negative values.
<p>
<h4>Task 3.1</h4>
Write a function <code>great_circle</code> to calculate the great circle distance between two points when given
coordinates on the globe.
<p>
Use your function to calculate two distances: Conway to Little Rock, and Conway to Tokyo. You should get the following output.
<p>
<pre>
>>> great_circle(35.0887, -92.4421, 34.7465, -92.2896)
>>> 25.138861294152708
>>> great_circle(35.0887, -92.4421, 35.6895, 139.6917)
>>> 6497.1752798603075
</pre>
<p>
<h2>Step 4 - Uploading Data</h2>
We are ready to explore the data! From the <a href="http://cityofconway.org">City of Conway</a>,
we have downloaded two publicly available datasets. 
<p>
First, <a href="../Schools.csv">Schools.csv</a>
is a comma-separated file that contains information on the 23 educational institutions in Conway. In this file, we can find
each school's latitude and longitude, the name, the type of school, and the street address.
<p>
Second, <a href="../Tornado_Sirens.csv">Tornado_Sirens.csv</a>
is a comma-separated file that contains information on the 30 tornado sirens in Conway. In this file, we can find
again the latitude and longitude of each siren, its approximate street address, elevation, and 
whether it is active.
<p>
For both files, the first column of information is the Longitude, and the second column is the Latitude.
<h4>Task 4.1</h4>
Download the two files above to your computer.
Select the folder icon next to the word "Files" in the upper-left corner of your Jupyter notebook.
This will return you to the project directory. Find the "Upload" button in the upper-right
corner, and use it to upload these two files to your project directory.
<p>
<h4>Task 4.2</h4>
Next we will load each file into a list of lists so we can have easy programatic access to our
information. Write code to open the Schools.csv file. The first line of the file is the 
header information, you should ignore this line. For each subsequent line in the file, strip it of whitespace 
and split it on the comma character ','. Add this list to a larger list called <code>schools</code>.
If you are successful, you should have the following value for <code>schools[1]</code>
<p>
<pre>
['-92.454169059470274',
 '35.095976925127481',
 '8',
 '0',
 'Ida Burns Elementary',
 'Elementary',
 '1201 DONAGHEY AVENUE',
 '{CE5DFB8D-1936-47D5-98FE-E7A171FDBCDF}']
</pre>
<p>
Also repeat the above code for the Tornado_Sirens.csv file to create a list called <code>sirens</code>.
If you are successful, you should have the following value for <code>sirens[1]</code>
<p>
<pre>
['-92.508840956149569',
 '35.111419057080532',
 '28',
 '',
 'OLD MORRILTON AND SANITATION',
 '',
 '"92° 30\' 31.827"" W"',
 '"35° 6\' 41.109"" N"',
 '',
 'Pr',
 '',
 '',
 'GISADMIN',
 '2015-02-27T14:40:26.000Z',
 '{3101BF55-F18C-425C-9193-348F9311E9C8}']
</pre>
<h2>Step 5 - Individual Schools </h2>
We can try to understand the effectiveness of the network of sirens by drawing a histogram
of the distances between schools and the sirens. We would expect in a network with good 
coverage, we would see a somewhat uniform distribution with some sirens nearby.

<h4>Task 5.1</h4>
Write a function called <code>siren_list(sc)</code> to return a list of distances between a given
school each of the sirens.
<p>
Next, draw a histogram of the distances found between Hendrix College all of the sirens. This 
graph should show the distribution of distances for sirens to schools.
Be sure to add a title and label your axes.
<p>
How many sirens are within 1/2 mile? Within 1 mile?
<img src="../images/cocalcsirenhendrix.png" width=400>

<h4>Task 5.2</h4>
Use your <code>siren_list</code> function to find the smallest distance to a siren for each
of the schools. Draw a histogram of these smallest distances found. This 
graph should show the distribution of minimum distances for sirens to schools.
Be sure to add a title and label your axes.
<p>
Which school has the lowest minimum distance? Which school has the highest minimum distance (furthest
away from any siren)?

<h2>Step 6 - School Coverage </h2>

plt.scatter for the schools
plt.scatter for the sirens

make the siren radius large
	s = 10000
	
make the color transparent

add title, label axes

Annotate the graph with hendrix and the school furthest away from any siren

Record all your answers in your Lab Evaluation Document.
<ol>
<li> What are the outgoing links from that page?
<li> How many total pages are reachable?
<li> What is the single longest path originating from that page?
</ol>

<h2>What to Hand In</h2>
Turn in your completed <tt>lab13.ipynb</tt> file on Moodle, as well as 
your Lab Evaluation Document.

<h2>Grading</h2>
<ul>
  <li>To earn a D on this lab, complete Task 1.1.</li>
  <li>To earn a C on this lab, do all the above and complete Task 1.2.</li>
  <li>To earn a B on this lab, do all the above and complete Step 2.</li>
  <li>To earn an A on this lab, do all the above and complete Tasks 3.1, 3.2 and 3.3.</li>
  <li>To earn a 100 on this lab, do all the above and complete Task 3.4.</li>
</ul>

<hr>
<small>&copy; Gabriel Ferrer and Mark Goadrich Hendrix College</small>
</BODY>
</HTML>
